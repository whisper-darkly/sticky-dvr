# sticky-dvr deploy environment — generated by scripts/configure.py
{%- set db = config.get('db', {}) %}
{%- set paths = config.get('paths', {}) %}

# ---- Paths (bind mounts) ----
DATA_DIR={{ paths.get('data_dir', '/opt/sticky-dvr') }}
RECORDINGS_DIR={{ paths.get('recordings_dir', '/opt/sticky-dvr/recordings') }}
CONFIG_DIR={{ paths.get('config_dir', '/opt/sticky-dvr/config') }}

# TLS certificates for the proxy.
# A self-signed cert is included in certs/ — sufficient for internal use.
# To use your own cert, replace certs/tls.crt and certs/tls.key, or point
# CERTS_DIR at a directory containing those two files.
CERTS_DIR={{ paths.get('certs_dir', './certs') }}

# ---- PostgreSQL ----
POSTGRES_USER={{ db.get('user', 'sticky') }}
POSTGRES_PASSWORD={{ secret('db_app_pass', type='urlsafe', bytes=18) }}
POSTGRES_DB={{ db.get('name', 'sticky') }}
POSTGRES_HOST={{ db.get('host', 'postgres') }}
POSTGRES_PORT={{ db.get('port', 5432) }}
PG_ADMIN_USER={{ db.get('admin_user', 'postgres') }}
PG_ADMIN_PASSWORD={{ secret('db_admin_pass', type='urlsafe', bytes=18) }}

# ---- Auth ----
JWT_SECRET={{ secret('jwt_secret', type='hex', bytes=32) }}
ADMIN_USERNAME={{ config.get('admin', {}).get('username', 'admin') }}
ADMIN_PASSWORD={{ secret('admin_password', type='urlsafe', bytes=18) }}

# ---- Service endpoints (container names = DNS hostnames) ----
OVERSEER_URL=ws://overseer:8080/ws
CONVERTER_URL=ws://converter:8080/ws
{% if config.dvr.converter.gpu %}
# ---- GPU (converter) ----
# Which GPU(s) to expose to the converter container.
# "all" = all GPUs; "0" = first GPU; "GPU-uuid" = specific GPU by UUID.
NVIDIA_VISIBLE_DEVICES=all
{% endif %}
