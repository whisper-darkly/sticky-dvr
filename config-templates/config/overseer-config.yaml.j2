# sticky-recorder overseer config
# Mounted at: /etc/sticky-overseer/config.yaml inside the overseer container
# Generated by scripts/configure.py â€” edit config.yaml to change defaults.

name: "sticky-recorder"
listen: ":8080"
db: /data/overseer.db

task_pool:
  limit: {{ config.dvr.task_pool.limit }}
  queue:
    enabled: true
    size: {{ config.dvr.task_pool.queue_size }}

actions:
{%- for site, enabled in config.dvr.sites.items() %}
{%- if enabled %}

  {{ site }}:
    type: exec
    dedupe_key: ["source"]
    retry:
      restart_delay: "30s"
      error_threshold: 0
      error_window: "0s"
    config:
      entrypoint: sticky-recorder
      command:
        - "-d"
        - "{{ site }}"
        - "-s"
        - "[[.source]]"
        - "-r"
        - "[[.resolution]]"
        - "-f"
        - "[[.framerate]]"
        - "-c"
        - "[[.cookies]]"
        - "-a"
        - "[[.user_agent]]"
        - "-o"
        - "[[.out]]"
        - "-i"
        - "[[.check_interval]]"
        - "-l"
        - "[[.segment_length]]"
        - "--heartbeat-interval"
        - "[[.heartbeat_interval]]"
        - "--output-format"
        - "json"
      parameters:
        source: {}
        out: {}
        resolution:
          default: "{{ config.dvr.recording.resolution }}"
          validate: 'value in ["480", "720", "1080"]'
        framerate:
          default: "{{ config.dvr.recording.framerate }}"
          validate: 'value in ["30", "60"]'
        cookies:
          default: ""
        user_agent:
          default: ""
        check_interval:
          default: "{{ config.dvr.recording.check_interval }}"
        segment_length:
          default: "{{ config.dvr.recording.segment_length }}"
        heartbeat_interval:
          default: "{{ config.dvr.recording.heartbeat_interval }}"
      output:
        stdout:
          condition: "has(output.json.event)"
        stderr:
          condition: "false"
{%- endif %}
{%- endfor %}
