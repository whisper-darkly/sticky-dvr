---
title: Align ADMIN_PASSWORD between compose.yaml dev default and test-api.sh
created: 2026-02-20
origin: Admin password mismatch prevents test-api.sh from working after docker compose up without env var override
priority: medium
complexity: low
notes:
  - Affects developer workflow: docker compose up â†’ ./scripts/test-api.sh
  - Simple one-line change to compose.yaml
  - Improves out-of-the-box developer experience
  - Test script already documents env var override if needed
---

Follow exactly and without stopping:

## Task: Align ADMIN_PASSWORD between compose.yaml dev default and test-api.sh

## Background & Context

During Phase 1 development, two configuration files were created with different assumptions about the default admin password:

1. **compose.yaml** (lines 41-47): The backend service environment sets ADMIN_PASSWORD to "change-me-on-first-run" as a security reminder that operators should change this password in production
2. **scripts/test-api.sh** (lines 11-12): The test script defaults to using "admin" as the admin password

These conflicting defaults create a poor developer experience. When an operator runs the standard development workflow:
```bash
docker compose up -d
sleep 3
./scripts/test-api.sh
```

The test script fails because it tries to authenticate with password "admin" but the backend was initialized with password "change-me-on-first-run". This is confusing because:
- No error message explicitly states the passwords don't match
- The test output shows "401 Unauthorized" for the login endpoint
- The operator must either manually set ADMIN_PASS environment variable or guess that passwords are misaligned
- This breaks the "make it work out of the box" principle for local development

## Problem Description

Actual failure scenario:

1. Operator runs: `docker compose up -d && sleep 3`
2. Backend starts with ADMIN_PASSWORD set to "change-me-on-first-run"
3. Admin user created with password hash for "change-me-on-first-run"
4. Operator runs: `./scripts/test-api.sh`
5. Test script tries login with password "admin"
6. Backend rejects credentials: password hash mismatch
7. Test 3 returns 401 instead of 200
8. Token extraction fails, subsequent tests silently fail with 401
9. Operator sees test failure with no clear reason

The jq extraction at line 72 of test-api.sh (`jq -r '.access_token // empty'`) works fine, but it extracts nothing from an error response, resulting in empty token and cascade failures.

Current values:
- compose.yaml ADMIN_PASSWORD: "change-me-on-first-run"
- test-api.sh ADMIN_PASS default: "admin"

## Implementation Plan

Choose Option A (recommended for developer workflow improvement):

### Option A: Change compose.yaml ADMIN_PASSWORD to "admin" (recommended)

This aligns the development default password with the test script, making `docker compose up && ./scripts/test-api.sh` work out of the box.

1. Open file: /home/mmulligan/Development/whisper-darkly-github/sticky-dvr/compose.yaml
2. Locate line 47 (backend service ADMIN_PASSWORD)
3. Change from:
   ```yaml
   ADMIN_PASSWORD: change-me-on-first-run
   ```
   to:
   ```yaml
   ADMIN_PASSWORD: admin  # Change this for production deployments
   ```
4. Add inline comment reminding operators to change for production
5. Optionally add a documentation note in CLAUDE.md or README about changing this in production
6. Save file
7. Verify by running: `docker compose up -d && sleep 3 && ./scripts/test-api.sh`

Rationale for Option A:
- Simplifies developer experience: standard workflow works without env var overrides
- "admin" is a well-understood default for development environments
- Inline comment clearly documents that this should change for production
- Aligns with test script expectations
- Test script already documents ADMIN_PASS env var for operator override if needed
- More secure than shipping "admin" hardcoded is that this is development-only (docker-compose for local dev, not production)

### Option B (if changing default is not acceptable): Update test-api.sh documentation

Alternative approach if compose.yaml defaults should remain strict:

1. Update test-api.sh header comment (lines 1-6) to document ADMIN_PASS requirement
2. Add explicit note that ADMIN_PASS env var must match ADMIN_PASSWORD in compose.yaml
3. This makes the requirement visible but still requires manual env var setup

For this project, **Option A is recommended** because development velocity matters and the inline comment serves as adequate production warning.

## Technical Requirements

If implementing Option A:
- File to modify: /home/mmulligan/Development/whisper-darkly-github/sticky-dvr/compose.yaml
- Line to change: 47 (ADMIN_PASSWORD: line in backend service environment)
- Change only the value from "change-me-on-first-run" to "admin"
- Add inline comment: "# Change this for production deployments"
- No other changes to compose.yaml structure or other environment variables

If implementing Option B:
- File to modify: /home/mmulligan/Development/whisper-darkly-github/sticky-dvr/scripts/test-api.sh
- Add documentation at top of file (lines 1-6) explaining ADMIN_PASS env var
- No code logic changes, only comments

## Success Criteria

For Option A implementation:

1. compose.yaml ADMIN_PASSWORD value is "admin"
2. compose.yaml includes comment "# Change this for production deployments"
3. Running `docker compose up -d && sleep 3 && ./scripts/test-api.sh` succeeds without setting ADMIN_PASS env var
4. Test 3 (POST /api/auth/login) returns 200 and extracts token successfully
5. Tests 4-12 execute with valid auth token and pass

For Option B implementation:

1. scripts/test-api.sh header includes documentation about ADMIN_PASS env var requirement
2. Developer can now read the comment and understand they must set ADMIN_PASS=change-me-on-first-run
3. Running ADMIN_PASS=change-me-on-first-run ./scripts/test-api.sh succeeds after docker compose up

## Expected Outcome

After Option A fix:
- New developers can run standard compose + test workflow without research
- Admin password defaults make sense for development environment
- Production operators have clear comment reminding them to change credentials
- Test script works out of the box with docker compose defaults

After Option B fix:
- Developer documentation is clear about the requirement
- Still requires explicit env var setup each time
- Better for strict security posture but less convenient for dev experience

## Reference Information

- compose.yaml location: /home/mmulligan/Development/whisper-darkly-github/sticky-dvr/compose.yaml
- Backend service config: lines 33-47 in compose.yaml
- Test script: /home/mmulligan/Development/whisper-darkly-github/sticky-dvr/scripts/test-api.sh (lines 11-12, 67-80)
- Database init: compose.yaml db-init service (uses ADMIN_PASSWORD)
- Related backend code: backend/main.go (reads ADMIN_PASSWORD and creates admin user on startup)

## Notes & Warnings

- IMPORTANT: If changing to "admin", ensure production deployment instructions clearly document changing this credential
- The backend only creates the admin user if it doesn't already exist (idempotent)
- Docker volumes persist across restarts, so changing ADMIN_PASSWORD in compose.yaml only affects fresh database creation
- If developers already have a database volume with the old password, they need `docker compose down` and `docker volume rm` to reset
- For Option A: The inline comment in compose.yaml serves as the production security reminder
- For Option B: Keep compose.yaml value as-is but improve documentation
- Either approach works; Option A recommended for better development experience without sacrificing security documentation
