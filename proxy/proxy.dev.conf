# proxy.dev.conf — HTTP-only NGINX config for local development.
# No TLS, no JWT validation. Injects synthetic user headers so the
# backend auth middleware works without a real session.

server {
    listen 80;
    server_name _;

    # Proxy frontend static files
    location / {
        proxy_pass         http://frontend:80/;
        proxy_http_version 1.1;
        proxy_set_header   Host              $host;
        proxy_set_header   Connection        "";
    }

    # Proxy API requests to backend
    location /api/ {
        proxy_pass         http://backend:8080/api/;
        proxy_http_version 1.1;
        proxy_set_header   Host              $host;
        proxy_set_header   X-Forwarded-For   $proxy_add_x_forwarded_for;
        proxy_set_header   X-Forwarded-Proto $scheme;
        proxy_set_header   Connection        "";

        # Synthetic user headers — dev mode always authenticates as admin user 1.
        # These bypass JWT validation so the backend routes work without a proxy JWT.
        proxy_set_header   X-User-Id         1;
        proxy_set_header   X-User-Role       admin;

        proxy_read_timeout  30s;
        proxy_send_timeout  30s;
    }

    # Proxy thumbnail requests (service may not be running — that's OK)
    location /thumbnails/ {
        proxy_pass http://thumbnailer:8080/;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_read_timeout 10s;
    }
}
